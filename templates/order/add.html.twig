{% extends 'base.html.twig' %}

{% block javascript %}
    <script src="https://js.stripe.com/v3/"></script>
{% endblock %} 

{% block title %}Paiement de ma commande{% endblock %}

{% block main %}
{# <pre>
    {{ dump(order) }}
</pre> #}
{% endblock %}
{% block script %}
<script type="text/javascript">
        var stripe = Stripe("pk_test_51OqXJJGKBR4VtUNOdno4aJjdWPAraJbiGmkmcWIAtr13IdgIGakrE9NkNjQSObQhGUZ8yiYUiYElXL0DUDuCh9rG00j018z2YV");
        var checkoutButton = document.getElementById("checkout-button");
        checkoutButton.addEventListener("click", function () {
                fetch("/commande/create-session/{{ reference }}", {
                    method: "POST",
                })
                .then(function (response) {
                    return response.json();
                })
                .then(function (session) {
                    if (session.error == 'app_order') {
                        window.location.replace('{{ path('app_order') }}');
                    } else {
                        return stripe.redirectToCheckout({ sessionId: session.id });
                    }
                })
                .then(function (result) { 
                    if(result.error) {
                        alert(result.error.message);
                    }
                })
                .catch(function (error) {
                    console.error("Error:", error);
                });
        });
</script>
{% endblock %}